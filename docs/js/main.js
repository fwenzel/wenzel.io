var b=class{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.animations=new Map,this.active=null,this.activeName=null,this.overlay=null,this.lastTime=0,this.resizeObserver=null,this.transition=null,this.viewportWidth=0,this.viewportHeight=0}register(t,i){this.animations.set(t,i)}start(t){let i=this.animations.get(t);if(!i)throw new Error(`Unknown animation: ${t}`);this.active=i,this.activeName=t,this.active.init(this.ctx,this.canvas),this.overlay&&this.overlay.init(this.ctx,this.canvas),this.lastTime=performance.now(),requestAnimationFrame(s=>this.tick(s))}tick(t){if(!this.active)return;let i=Math.min(64,t-this.lastTime);this.lastTime=t,this.active.update(i),this.overlay&&this.overlay.update(i),this.active.render(),this.overlay&&this.overlay.render(),this.transition&&this.renderTransition(i),requestAnimationFrame(s=>this.tick(s))}bindResize(){let t=()=>{let{width:i,height:s}=this.canvas.getBoundingClientRect(),h=window.devicePixelRatio||1;this.canvas.width=Math.max(1,Math.floor(i*h)),this.canvas.height=Math.max(1,Math.floor(s*h)),this.ctx.setTransform(h,0,0,h,0,0),this.viewportWidth=i,this.viewportHeight=s,this.active&&this.active.onResize(i,s),this.overlay&&this.overlay.onResize(i,s)};"ResizeObserver"in window?(this.resizeObserver=new ResizeObserver(t),this.resizeObserver.observe(this.canvas)):window.addEventListener("resize",t),t()}setOverlay(t){this.overlay=t}switchTo(t){if(!t||t===this.activeName)return;if(!this.animations.get(t))throw new Error(`Unknown animation: ${t}`);this.transition={phase:"out",elapsed:0,duration:800,nextName:t}}renderTransition(t){if(!this.transition)return;let i=this.ctx,s=this.transition;s.elapsed+=t;let h=Math.min(1,s.elapsed/s.duration);if(s.phase==="out"&&h>=1){let a=this.animations.get(s.nextName);this.active=a,this.activeName=s.nextName,this.active.init(this.ctx,this.canvas),this.viewportWidth&&this.viewportHeight&&this.active.onResize(this.viewportWidth,this.viewportHeight),s.phase="in",s.elapsed=0}let e=s.phase==="out"?h:1-Math.min(1,s.elapsed/s.duration);i.save(),i.fillStyle=`rgba(5, 6, 8, ${e})`,i.fillRect(0,0,this.viewportWidth,this.viewportHeight),i.restore(),s.phase==="in"&&s.elapsed>=s.duration&&(this.transition=null)}};var f=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.groups=[],this.fade=.1,this.time=0}init(t,i){this.ctx=t,this.canvas=i,this.reset()}reset(){this.groups=[];let t=3,i=5;for(let s=0;s<t;s+=1){let h=Math.floor(Math.random()*360),e=[],a=[];for(let l=0;l<i;l+=1){e.push({x:Math.random()*this.width,y:Math.random()*this.height});let n=40+Math.random()*80,c=Math.random()*Math.PI*2;a.push({x:Math.cos(c)*n,y:Math.sin(c)*n})}this.groups.push({hue:h,points:e,velocities:a})}}onResize(t,i){this.width=t,this.height=i,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,i),this.reset()}update(t){this.time+=t/1e3;let i=t/1e3;for(let s of this.groups)s.points.forEach((h,e)=>{let a=s.velocities[e];h.x+=a.x*i,h.y+=a.y*i,(h.x<=0||h.x>=this.width)&&(a.x*=-1),(h.y<=0||h.y>=this.height)&&(a.y*=-1),h.x=Math.max(0,Math.min(this.width,h.x)),h.y=Math.max(0,Math.min(this.height,h.y))})}render(){let t=this.ctx;t.fillStyle=`rgba(0, 0, 0, ${this.fade})`,t.fillRect(0,0,this.width,this.height),t.lineWidth=2,t.globalCompositeOperation="lighter";for(let i of this.groups)t.strokeStyle=`hsla(${i.hue}, 90%, 65%, 0.85)`,t.beginPath(),i.points.forEach((s,h)=>{h===0?t.moveTo(s.x,s.y):t.lineTo(s.x,s.y)}),t.closePath(),t.stroke();t.globalCompositeOperation="source-over"}};var M=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.paddleHeight=80,this.paddleWidth=10,this.paddleInset=24,this.ballRadius=6,this.leftPaddle={y:0,vy:0},this.rightPaddle={y:0,vy:0},this.ball={x:0,y:0,vx:0,vy:0},this.fade=.18,this.leftError=(Math.random()-.5)*16,this.rightError=(Math.random()-.5)*16}init(t,i){this.ctx=t,this.canvas=i,this.reset()}onResize(t,i){this.width=t,this.height=i,this.paddleHeight=Math.max(70,Math.min(140,i*.18)),this.paddleWidth=Math.max(8,Math.min(14,t*.015)),this.ballRadius=Math.max(5,Math.min(9,t*.01)),this.paddleInset=Math.max(18,Math.min(40,t*.05)),this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,i),this.reset()}reset(){this.leftError=(Math.random()-.5)*18,this.rightError=(Math.random()-.5)*18,this.leftPaddle.y=this.height/2,this.rightPaddle.y=this.height/2,this.leftPaddle.vy=0,this.rightPaddle.vy=0,this.ball.x=this.width/2,this.ball.y=this.height/2;let t=Math.max(180,Math.min(320,this.width*.25)),i=(Math.random()*.6-.3)*Math.PI,s=Math.random()>.5?1:-1;this.ball.vx=Math.cos(i)*t*s,this.ball.vy=Math.sin(i)*t}update(t){let i=t/1e3,s=this.getPaddleTargetY("left"),h=this.getPaddleTargetY("right");this.updatePaddle(this.leftPaddle,s,i,.9),this.updatePaddle(this.rightPaddle,h,i,.75),this.ball.x+=this.ball.vx*i,this.ball.y+=this.ball.vy*i,(this.ball.y-this.ballRadius<=0||this.ball.y+this.ballRadius>=this.height)&&(this.ball.vy*=-1,this.ball.y=Math.max(this.ballRadius,Math.min(this.height-this.ballRadius,this.ball.y)));let e=this.paddleInset+this.paddleWidth,a=this.width-this.paddleInset-this.paddleWidth;this.ball.vx<0&&this.ball.x-this.ballRadius<=e?this.handlePaddleHit(this.leftPaddle,e):this.ball.vx>0&&this.ball.x+this.ballRadius>=a&&this.handlePaddleHit(this.rightPaddle,a),(this.ball.x<-this.ballRadius*4||this.ball.x>this.width+this.ballRadius*4)&&this.reset()}updatePaddle(t,i,s,h){let e=(i-t.y)*h,a=Math.max(160,Math.min(320,this.height*.6));t.vy+=e*s*6,t.vy=Math.max(-a,Math.min(a,t.vy)),t.y+=t.vy*s,t.vy*=.92;let l=this.paddleHeight/2;t.y=Math.max(l,Math.min(this.height-l,t.y))}getPaddleTargetY(t){let i=t==="left"?this.paddleInset+this.paddleWidth:this.width-this.paddleInset-this.paddleWidth,s=t==="left"&&this.ball.vx<0||t==="right"&&this.ball.vx>0,h=t==="left"?this.leftError:this.rightError;if(!s||Math.abs(this.ball.vx)<10)return this.ball.y+h;let e=(i-this.ball.x)/this.ball.vx,a=this.ball.y+this.ball.vy*e;return this.reflectY(a)+h}reflectY(t){if(this.height<=0)return t;let i=(this.height-this.ballRadius)*2;if(i<=0)return t;let s=t;return(s<0||s>this.height)&&(s=(s%i+i)%i,s>this.height&&(s=i-s)),Math.max(this.ballRadius,Math.min(this.height-this.ballRadius,s))}handlePaddleHit(t,i){let s=this.paddleHeight/2;if(this.ball.y<t.y-s||this.ball.y>t.y+s)return;let e=(this.ball.y-t.y)/s*Math.PI*.35,a=Math.min(420,Math.hypot(this.ball.vx,this.ball.vy)*1.03),l=this.ball.vx<0?1:-1;this.ball.vx=Math.cos(e)*a*l,this.ball.vy=Math.sin(e)*a,l>0?this.ball.x=i+this.ballRadius+1:this.ball.x=i-this.ballRadius-1}render(){let t=this.ctx;t.fillStyle=`rgba(5, 6, 8, ${this.fade})`,t.fillRect(0,0,this.width,this.height),t.fillStyle="rgba(210, 210, 210, 0.7)";let i=12,s=18;for(let h=s;h<this.height-s;h+=i+s)t.fillRect(this.width/2-1,h,2,i);t.fillStyle="rgba(235, 235, 235, 0.85)",t.fillRect(this.paddleInset,this.leftPaddle.y-this.paddleHeight/2,this.paddleWidth,this.paddleHeight),t.fillRect(this.width-this.paddleInset-this.paddleWidth,this.rightPaddle.y-this.paddleHeight/2,this.paddleWidth,this.paddleHeight),t.beginPath(),t.arc(this.ball.x,this.ball.y,this.ballRadius,0,Math.PI*2),t.fill()}};var x=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.pretzels=[],this.sprites=[],this.fade=.2}init(t,i){this.ctx=t,this.canvas=i,this.sprites=this.buildPretzelSprites(),this.reset()}onResize(t,i){this.width=t,this.height=i,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,i),this.reset()}reset(){let t=Math.max(8,Math.min(24,this.width*this.height/4e4)),i=Math.round(t);this.pretzels=Array.from({length:i},()=>this.spawnPretzel())}spawnPretzel(){let t=this.sprites[Math.floor(Math.random()*this.sprites.length)],i=36+Math.random()*110,s=30+Math.random()*90,h=Math.floor(Math.random()*4),e=0,a=0,l=0;return h===0?(e=-i,a=Math.random()*this.height,l=(-.35+Math.random()*.7)*Math.PI):h===1?(e=this.width+i,a=Math.random()*this.height,l=(.65+Math.random()*.7)*Math.PI):h===2?(e=Math.random()*this.width,a=-i,l=(.15+Math.random()*.7)*Math.PI):(e=Math.random()*this.width,a=this.height+i,l=(-.85+Math.random()*.7)*Math.PI),{sprite:t,x:e,y:a,size:i,vx:Math.cos(l)*s,vy:Math.sin(l)*s,rotation:Math.random()*Math.PI*2,rotationSpeed:(-.7+Math.random()*1.4)*Math.PI,alpha:.5+Math.random()*.4}}update(t){let i=t/1e3,s=180;for(let h=0;h<this.pretzels.length;h+=1){let e=this.pretzels[h];e.x+=e.vx*i,e.y+=e.vy*i,e.rotation+=e.rotationSpeed*i,(e.x<-s||e.x>this.width+s||e.y<-s||e.y>this.height+s)&&(this.pretzels[h]=this.spawnPretzel())}}render(){let t=this.ctx;t.fillStyle=`rgba(5, 6, 8, ${this.fade})`,t.fillRect(0,0,this.width,this.height);for(let i of this.pretzels){let s=i.sprite;if(!s||!s.complete)continue;let h=i.size/s.width,e=s.width*h,a=s.height*h;t.save(),t.translate(i.x,i.y),t.rotate(i.rotation),t.globalAlpha=i.alpha,t.drawImage(s,-e/2,-a/2,e,a),t.restore()}}buildPretzelSprites(){let t=new Image;return t.src="img/pretzel.svg",[t]}};var u=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.label=null,this.labelMetrics=null,this.glitchTimer=0,this.nextGlitchIn=3+Math.random()*6}init(t,i){this.ctx=t,this.canvas=i,this.width&&this.height&&(this.labelMetrics=this.computeLabelMetrics(),this.label=this.buildLabel())}onResize(t,i){this.width=t,this.height=i,this.labelMetrics=this.computeLabelMetrics(),this.label=this.buildLabel()}update(t){this.updateLabel(t/1e3),this.updateGlitch(t/1e3)}render(){this.renderLabels()}buildLabel(){this.labelMetrics||(this.labelMetrics=this.computeLabelMetrics());let{width:t,height:i,margin:s}=this.labelMetrics,h=s+t/2,e=Math.max(h,this.width-s-t/2),a=s+i/2,l=Math.max(a,this.height-s-i/2);return{x:h+Math.random()*(e-h),y:a+Math.random()*(l-a),alpha:0,direction:1,speed:.08+Math.random()*.05}}updateLabel(t){this.label&&(this.label.alpha+=this.label.direction*this.label.speed*t,this.label.alpha>=.5&&(this.label.alpha=.5,this.label.direction=-1),this.label.alpha<=0&&(this.label=this.buildLabel()))}renderLabels(){let t=this.ctx;if(!this.label||!this.labelMetrics||!this.labelMetrics.sprite)return;let{sprite:i,scale:s}=this.labelMetrics;if(!i.complete)return;let h=i.width*s,e=i.height*s;t.save(),t.globalAlpha=this.label.alpha,t.imageSmoothingEnabled=!1;let a=this.label.x-h/2,l=this.label.y-e/2;this.renderStatic(t,a,l,h,e);let n=this.glitchTimer>0?(Math.random()-.5)*12:0;if(t.drawImage(i,a+n,l,h,e),this.glitchTimer>0){let c=3+Math.floor(Math.random()*4);for(let m=0;m<c;m+=1){let o=Math.max(2,Math.floor(e*.1)),p=Math.floor(Math.random()*(e-o)),g=l+p+(Math.random()-.5)*10,y=a+(Math.random()-.5)*18;t.drawImage(i,0,p/s,i.width,o/s,y,g,h,o)}}t.restore()}computeLabelMetrics(){let t=Math.max(18,Math.min(this.width,this.height)*.06),i="wenzel.io",s=this.getPixelFont(),h=i.length*s.width+(i.length-1)*s.spacing,e=s.height,a=this.buildLabelSprite(i,s,h,e),l=t/e,n=Math.max(24,t*.75);return{width:h*l,height:e*l,margin:n,scale:l,sprite:a}}getPixelFont(){return{width:5,height:7,spacing:1,glyphs:{w:["10001","10001","10001","10101","10101","10101","01010"],e:["01110","10001","11111","10000","10000","10001","01110"],n:["10001","11001","10101","10011","10001","10001","10001"],z:["11111","00001","00010","00100","01000","10000","11111"],l:["10000","10000","10000","10000","10000","10000","11111"],i:["00100","00000","01100","00100","00100","00100","01110"],o:["01110","10001","10001","10001","10001","10001","01110"],".":["00000","00000","00000","00000","00000","00100","00100"]}}}buildLabelSprite(t,i,s,h){let e=[],a=0;for(let c of t)(i.glyphs[c]||i.glyphs["."]).forEach((o,p)=>{for(let g=0;g<o.length;g+=1)o[g]==="1"&&e.push(`<rect x="${a+g}" y="${p}" width="1" height="1" />`)}),a+=i.width+i.spacing;let l=`
      <svg xmlns="http://www.w3.org/2000/svg" width="${s}" height="${h}">
        <g fill="#aaaaaa">${e.join("")}</g>
      </svg>
    `.trim(),n=new Image;return n.src=`data:image/svg+xml;utf8,${encodeURIComponent(l)}`,n}renderStatic(t,i,s,h,e){let a=this.glitchTimer>0?.5:.08;if(Math.random()>a)return;let l=this.glitchTimer>0?40:14;t.save(),t.globalAlpha*=this.glitchTimer>0?.6:.35,t.fillStyle="#b8b8b8";for(let n=0;n<l;n+=1){let c=i+Math.random()*h,m=s+Math.random()*e,o=Math.random()>.7?2:1;t.fillRect(c,m,o,o)}t.restore()}updateGlitch(t){this.nextGlitchIn-=t,this.nextGlitchIn<=0&&(this.glitchTimer=.35+Math.random()*.5,this.nextGlitchIn=1.8+Math.random()*4),this.glitchTimer>0&&(this.glitchTimer=Math.max(0,this.glitchTimer-t))}};var w=document.getElementById("stage"),d=new b(w);d.setOverlay(new u);d.register("mystify",new f);d.register("pong",new M);d.register("pretzels",new x);d.bindResize();var P=Array.from(d.animations.keys()),v=r=>{let t=P.filter(i=>i!==r);return t.length===0?r:t[Math.floor(Math.random()*t.length)]},R=v(null);d.start(R);window.setInterval(()=>{let r=v(d.activeName);d.switchTo(r)},1e4);
