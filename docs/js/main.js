var f=class{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.animations=new Map,this.active=null,this.activeName=null,this.overlay=null,this.lastTime=0,this.resizeObserver=null,this.transition=null,this.viewportWidth=0,this.viewportHeight=0}register(t,i){this.animations.set(t,i)}start(t){let i=this.animations.get(t);if(!i)throw new Error(`Unknown animation: ${t}`);this.active=i,this.activeName=t,this.active.init(this.ctx,this.canvas),this.overlay&&this.overlay.init(this.ctx,this.canvas),this.lastTime=performance.now(),requestAnimationFrame(e=>this.tick(e))}tick(t){if(!this.active)return;let i=Math.min(64,t-this.lastTime);this.lastTime=t,this.active.update(i),this.overlay&&this.overlay.update(i),this.active.render(),this.overlay&&this.overlay.render(),this.transition&&this.renderTransition(i),requestAnimationFrame(e=>this.tick(e))}bindResize(){let t=()=>{let{width:i,height:e}=this.canvas.getBoundingClientRect(),s=window.devicePixelRatio||1;this.canvas.width=Math.max(1,Math.floor(i*s)),this.canvas.height=Math.max(1,Math.floor(e*s)),this.ctx.setTransform(s,0,0,s,0,0),this.viewportWidth=i,this.viewportHeight=e,this.active&&this.active.onResize(i,e),this.overlay&&this.overlay.onResize(i,e)};"ResizeObserver"in window?(this.resizeObserver=new ResizeObserver(t),this.resizeObserver.observe(this.canvas)):window.addEventListener("resize",t),t()}setOverlay(t){this.overlay=t}switchTo(t){if(!t||t===this.activeName)return;if(!this.animations.get(t))throw new Error(`Unknown animation: ${t}`);this.transition={phase:"out",elapsed:0,duration:800,nextName:t}}renderTransition(t){if(!this.transition)return;let i=this.ctx,e=this.transition;e.elapsed+=t;let s=Math.min(1,e.elapsed/e.duration);if(e.phase==="out"&&s>=1){let a=this.animations.get(e.nextName);this.active=a,this.activeName=e.nextName,this.active.init(this.ctx,this.canvas),this.viewportWidth&&this.viewportHeight&&this.active.onResize(this.viewportWidth,this.viewportHeight),e.phase="in",e.elapsed=0}let h=e.phase==="out"?s:1-Math.min(1,e.elapsed/e.duration);i.save(),i.fillStyle=`rgba(5, 6, 8, ${h})`,i.fillRect(0,0,this.viewportWidth,this.viewportHeight),i.restore(),e.phase==="in"&&e.elapsed>=e.duration&&(this.transition=null)}};var u=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.groups=[],this.fade=.1,this.time=0}init(t,i){this.ctx=t,this.canvas=i,this.reset()}reset(){this.groups=[];let t=3,i=5;for(let e=0;e<t;e+=1){let s=Math.floor(Math.random()*360),h=[],a=[];for(let n=0;n<i;n+=1){h.push({x:Math.random()*this.width,y:Math.random()*this.height});let r=40+Math.random()*80,c=Math.random()*Math.PI*2;a.push({x:Math.cos(c)*r,y:Math.sin(c)*r})}this.groups.push({hue:s,points:h,velocities:a})}}onResize(t,i){this.width=t,this.height=i,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,i),this.reset()}update(t){this.time+=t/1e3;let i=t/1e3;for(let e of this.groups)e.points.forEach((s,h)=>{let a=e.velocities[h];s.x+=a.x*i,s.y+=a.y*i,(s.x<=0||s.x>=this.width)&&(a.x*=-1),(s.y<=0||s.y>=this.height)&&(a.y*=-1),s.x=Math.max(0,Math.min(this.width,s.x)),s.y=Math.max(0,Math.min(this.height,s.y))})}render(){let t=this.ctx;t.fillStyle=`rgba(0, 0, 0, ${this.fade})`,t.fillRect(0,0,this.width,this.height),t.lineWidth=2,t.globalCompositeOperation="lighter";for(let i of this.groups)t.strokeStyle=`hsla(${i.hue}, 90%, 65%, 0.85)`,t.beginPath(),i.points.forEach((e,s)=>{s===0?t.moveTo(e.x,e.y):t.lineTo(e.x,e.y)}),t.closePath(),t.stroke();t.globalCompositeOperation="source-over"}};var M=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.pretzels=[],this.sprites=[],this.fade=.2}init(t,i){this.ctx=t,this.canvas=i,this.sprites=this.buildPretzelSprites(),this.reset()}onResize(t,i){this.width=t,this.height=i,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,t,i),this.reset()}reset(){let t=Math.max(8,Math.min(24,this.width*this.height/4e4)),i=Math.round(t);this.pretzels=Array.from({length:i},()=>this.spawnPretzel())}spawnPretzel(){let t=this.sprites[Math.floor(Math.random()*this.sprites.length)],i=36+Math.random()*110,e=30+Math.random()*90,s=Math.floor(Math.random()*4),h=0,a=0,n=0;return s===0?(h=-i,a=Math.random()*this.height,n=(-.35+Math.random()*.7)*Math.PI):s===1?(h=this.width+i,a=Math.random()*this.height,n=(.65+Math.random()*.7)*Math.PI):s===2?(h=Math.random()*this.width,a=-i,n=(.15+Math.random()*.7)*Math.PI):(h=Math.random()*this.width,a=this.height+i,n=(-.85+Math.random()*.7)*Math.PI),{sprite:t,x:h,y:a,size:i,vx:Math.cos(n)*e,vy:Math.sin(n)*e,rotation:Math.random()*Math.PI*2,rotationSpeed:(-.7+Math.random()*1.4)*Math.PI,alpha:.5+Math.random()*.4}}update(t){let i=t/1e3,e=180;for(let s=0;s<this.pretzels.length;s+=1){let h=this.pretzels[s];h.x+=h.vx*i,h.y+=h.vy*i,h.rotation+=h.rotationSpeed*i,(h.x<-e||h.x>this.width+e||h.y<-e||h.y>this.height+e)&&(this.pretzels[s]=this.spawnPretzel())}}render(){let t=this.ctx;t.fillStyle=`rgba(5, 6, 8, ${this.fade})`,t.fillRect(0,0,this.width,this.height);for(let i of this.pretzels){let e=i.sprite;if(!e||!e.complete)continue;let s=i.size/e.width,h=e.width*s,a=e.height*s;t.save(),t.translate(i.x,i.y),t.rotate(i.rotation),t.globalAlpha=i.alpha,t.drawImage(e,-h/2,-a/2,h,a),t.restore()}}buildPretzelSprites(){let t=new Image;return t.src="img/pretzel.svg",[t]}};var v=class{constructor(){this.ctx=null,this.canvas=null,this.width=0,this.height=0,this.label=null,this.labelMetrics=null,this.glitchTimer=0,this.nextGlitchIn=3+Math.random()*6}init(t,i){this.ctx=t,this.canvas=i,this.width&&this.height&&(this.labelMetrics=this.computeLabelMetrics(),this.label=this.buildLabel())}onResize(t,i){this.width=t,this.height=i,this.labelMetrics=this.computeLabelMetrics(),this.label=this.buildLabel()}update(t){this.updateLabel(t/1e3),this.updateGlitch(t/1e3)}render(){this.renderLabels()}buildLabel(){this.labelMetrics||(this.labelMetrics=this.computeLabelMetrics());let{width:t,height:i,margin:e}=this.labelMetrics,s=e+t/2,h=Math.max(s,this.width-e-t/2),a=e+i/2,n=Math.max(a,this.height-e-i/2);return{x:s+Math.random()*(h-s),y:a+Math.random()*(n-a),alpha:0,direction:1,speed:.08+Math.random()*.05}}updateLabel(t){this.label&&(this.label.alpha+=this.label.direction*this.label.speed*t,this.label.alpha>=.5&&(this.label.alpha=.5,this.label.direction=-1),this.label.alpha<=0&&(this.label=this.buildLabel()))}renderLabels(){let t=this.ctx;if(!this.label||!this.labelMetrics||!this.labelMetrics.sprite)return;let{sprite:i,scale:e}=this.labelMetrics;if(!i.complete)return;let s=i.width*e,h=i.height*e;t.save(),t.globalAlpha=this.label.alpha,t.imageSmoothingEnabled=!1;let a=this.label.x-s/2,n=this.label.y-h/2;this.renderStatic(t,a,n,s,h);let r=this.glitchTimer>0?(Math.random()-.5)*12:0;if(t.drawImage(i,a+r,n,s,h),this.glitchTimer>0){let c=3+Math.floor(Math.random()*4);for(let g=0;g<c;g+=1){let o=Math.max(2,Math.floor(h*.1)),p=Math.floor(Math.random()*(h-o)),m=n+p+(Math.random()-.5)*10,x=a+(Math.random()-.5)*18;t.drawImage(i,0,p/e,i.width,o/e,x,m,s,o)}}t.restore()}computeLabelMetrics(){let t=Math.max(18,Math.min(this.width,this.height)*.06),i="wenzel.io",e=this.getPixelFont(),s=i.length*e.width+(i.length-1)*e.spacing,h=e.height,a=this.buildLabelSprite(i,e,s,h),n=t/h,r=Math.max(24,t*.75);return{width:s*n,height:h*n,margin:r,scale:n,sprite:a}}getPixelFont(){return{width:5,height:7,spacing:1,glyphs:{w:["10001","10001","10001","10101","10101","10101","01010"],e:["01110","10001","11111","10000","10000","10001","01110"],n:["10001","11001","10101","10011","10001","10001","10001"],z:["11111","00001","00010","00100","01000","10000","11111"],l:["10000","10000","10000","10000","10000","10000","11111"],i:["00100","00000","01100","00100","00100","00100","01110"],o:["01110","10001","10001","10001","10001","10001","01110"],".":["00000","00000","00000","00000","00000","00100","00100"]}}}buildLabelSprite(t,i,e,s){let h=[],a=0;for(let c of t)(i.glyphs[c]||i.glyphs["."]).forEach((o,p)=>{for(let m=0;m<o.length;m+=1)o[m]==="1"&&h.push(`<rect x="${a+m}" y="${p}" width="1" height="1" />`)}),a+=i.width+i.spacing;let n=`
      <svg xmlns="http://www.w3.org/2000/svg" width="${e}" height="${s}">
        <g fill="#aaaaaa">${h.join("")}</g>
      </svg>
    `.trim(),r=new Image;return r.src=`data:image/svg+xml;utf8,${encodeURIComponent(n)}`,r}renderStatic(t,i,e,s,h){let a=this.glitchTimer>0?.5:.08;if(Math.random()>a)return;let n=this.glitchTimer>0?40:14;t.save(),t.globalAlpha*=this.glitchTimer>0?.6:.35,t.fillStyle="#b8b8b8";for(let r=0;r<n;r+=1){let c=i+Math.random()*s,g=e+Math.random()*h,o=Math.random()>.7?2:1;t.fillRect(c,g,o,o)}t.restore()}updateGlitch(t){this.nextGlitchIn-=t,this.nextGlitchIn<=0&&(this.glitchTimer=.35+Math.random()*.5,this.nextGlitchIn=1.8+Math.random()*4),this.glitchTimer>0&&(this.glitchTimer=Math.max(0,this.glitchTimer-t))}};var b=document.getElementById("stage"),d=new f(b);d.setOverlay(new v);d.register("mystify",new u);d.register("pretzels",new M);d.bindResize();var y=Array.from(d.animations.keys()),w=l=>{let t=y.filter(i=>i!==l);return t.length===0?l:t[Math.floor(Math.random()*t.length)]},z=w(null);d.start(z);window.setInterval(()=>{let l=w(d.activeName);d.switchTo(l)},1e4);
